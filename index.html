<!DOCTYPE html>
<html>
<head>
  <title>YouTube Live Chat</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
  <style>
    body { font-family: Arial; padding: 20px; background: #111; color: #eee; }
    #chat { max-height: 400px; overflow-y: scroll; background: #222; padding: 10px; margin-top: 10px; border-radius: 10px; }
    .message { padding: 5px 10px; border-bottom: 1px solid #333; }
    #msgInput { width: 80%; padding: 10px; }
    #sendBtn { padding: 10px; }
  </style>
</head>
<body>

<h2>YouTube Live Chat</h2>
<button onclick="signIn()">Sign in with YouTube</button>
<div id="userInfo"></div>

<div id="chat"></div>

<input type="text" id="msgInput" placeholder="Type your message..." />
<button onclick="sendMessage()" id="sendBtn">Send</button>

<script>
  // ✅ Your Firebase Config
  const firebaseConfig = {
    apiKey: "AIzaSyCq74S-8b4maDXEKkDXwoaz28Y_Qf0N_34",
    authDomain: "livestreamchat-268a9.firebaseapp.com",
    databaseURL: "https://livestreamchat-268a9-default-rtdb.firebaseio.com",
    projectId: "livestreamchat-268a9",
    storageBucket: "livestreamchat-268a9.appspot.com",
    messagingSenderId: "761482927725",
    appId: "1:761482927725:web:7d525941da69c424bb6964"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  let currentUser = null;
  let youtubeName = null;

  function signIn() {
    const provider = new firebase.auth.GoogleAuthProvider();
    provider.addScope('https://www.googleapis.com/auth/youtube.readonly');

    firebase.auth().signInWithPopup(provider)
      .then(async result => {
        const token = result.credential.accessToken;
        currentUser = result.user;
        document.getElementById('userInfo').innerText = `Signed in as: ${currentUser.displayName}`;

        // ✅ Get YouTube Channel Name
        const res = await fetch('https://www.googleapis.com/youtube/v3/channels?part=snippet&mine=true', {
          headers: {
            Authorization: `Bearer ${token}`,
            Accept: 'application/json'
          }
        });
        const data = await res.json();
        youtubeName = data.items[0].snippet.title;
        document.getElementById('userInfo').innerText += ` (YouTube: ${youtubeName})`;
      })
      .catch(err => {
        console.error("Auth error:", err.message);
        alert("Sign-in failed: " + err.message);
      });
  }

  function sendMessage() {
    const msg = document.getElementById('msgInput').value.trim();
    if (!msg || !youtubeName) return;
    db.ref('chat').push({
      name: youtubeName,
      text: msg,
      time: Date.now()
    });
    document.getElementById('msgInput').value = '';
  }

  // 🔁 Realtime chat updates
  db.ref('chat').on('child_added', snap => {
    const data = snap.val();
    const div = document.createElement('div');
    div.className = 'message';
    div.innerText = `${data.name}: ${data.text}`;
    document.getElementById('chat').appendChild(div);
    document.getElementById('chat').scrollTop = document.getElementById('chat').scrollHeight;
  });
</script>

</body>
</html>
