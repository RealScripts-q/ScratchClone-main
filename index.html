<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Live Stream Chat with Firebase</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 600px; margin: 2rem auto; }
  #chat { border: 1px solid #ccc; padding: 1rem; height: 300px; overflow-y: scroll; margin-bottom: 1rem; background: #f9f9f9; }
  #chat p { margin: 0 0 10px; }
  #loginForm, #signupForm, #chatForm { margin-bottom: 1rem; }
  #chatForm input[type=text] { width: 80%; padding: 0.5rem; }
  #chatForm button { padding: 0.5rem 1rem; }
  #userInfo { margin-bottom: 1rem; }
  .hidden { display: none; }
</style>
</head>
<body>

<h1>Live Stream Chat</h1>

<div id="userInfo" class="hidden">
  Logged in as: <span id="userEmail"></span> 
  <button id="logoutBtn">Logout</button>
</div>

<!-- Signup Form -->
<div id="signupForm">
  <h3>Sign Up</h3>
  <input type="email" id="signupEmail" placeholder="Email" />
  <input type="password" id="signupPassword" placeholder="Password" />
  <button id="signupBtn">Sign Up</button>
  <p>Already have an account? <a href="#" id="showLogin">Login here</a></p>
</div>

<!-- Login Form -->
<div id="loginForm" class="hidden">
  <h3>Login</h3>
  <input type="email" id="loginEmail" placeholder="Email" />
  <input type="password" id="loginPassword" placeholder="Password" />
  <button id="loginBtn">Login</button>
  <p>Don't have an account? <a href="#" id="showSignup">Sign up here</a></p>
</div>

<!-- Chat Dashboard -->
<div id="dashboard" class="hidden">
  <div id="chat"></div>
  <form id="chatForm">
    <input type="text" id="messageInput" placeholder="Type a message..." autocomplete="off" required />
    <button type="submit">Send</button>
  </form>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  // Your Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyCq74S-8b4maDXEKkDXwoaz28Y_Qf0N_34",
    authDomain: "livestreamchat-268a9.firebaseapp.com",
    databaseURL: "https://livestreamchat-268a9-default-rtdb.firebaseio.com",
    projectId: "livestreamchat-268a9",
    storageBucket: "livestreamchat-268a9.firebasestorage.app",
    messagingSenderId: "761482927725",
    appId: "1:761482927725:web:7d525941da69c424bb6964"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.database();

  // DOM Elements
  const signupForm = document.getElementById('signupForm');
  const loginForm = document.getElementById('loginForm');
  const dashboard = document.getElementById('dashboard');
  const userInfo = document.getElementById('userInfo');
  const userEmailSpan = document.getElementById('userEmail');
  const logoutBtn = document.getElementById('logoutBtn');

  const signupEmail = document.getElementById('signupEmail');
  const signupPassword = document.getElementById('signupPassword');
  const signupBtn = document.getElementById('signupBtn');

  const loginEmail = document.getElementById('loginEmail');
  const loginPassword = document.getElementById('loginPassword');
  const loginBtn = document.getElementById('loginBtn');

  const showLoginLink = document.getElementById('showLogin');
  const showSignupLink = document.getElementById('showSignup');

  const chatDiv = document.getElementById('chat');
  const chatForm = document.getElementById('chatForm');
  const messageInput = document.getElementById('messageInput');

  // Switch between signup/login forms
  showLoginLink.onclick = e => {
    e.preventDefault();
    signupForm.classList.add('hidden');
    loginForm.classList.remove('hidden');
  };

  showSignupLink.onclick = e => {
    e.preventDefault();
    loginForm.classList.add('hidden');
    signupForm.classList.remove('hidden');
  };

  // Signup handler
  signupBtn.onclick = e => {
    e.preventDefault();
    const email = signupEmail.value.trim();
    const pass = signupPassword.value;
    auth.createUserWithEmailAndPassword(email, pass)
      .catch(err => alert(err.message));
  };

  // Login handler
  loginBtn.onclick = e => {
    e.preventDefault();
    const email = loginEmail.value.trim();
    const pass = loginPassword.value;
    auth.signInWithEmailAndPassword(email, pass)
      .catch(err => alert(err.message));
  };

  // Logout
  logoutBtn.onclick = () => auth.signOut();

  // Auth state change
  auth.onAuthStateChanged(user => {
    if (user) {
      // Logged in
      userEmailSpan.textContent = user.email;
      signupForm.classList.add('hidden');
      loginForm.classList.add('hidden');
      userInfo.classList.remove('hidden');
      dashboard.classList.remove('hidden');

      // Load chat messages and listen for new ones
      loadChatMessages();
    } else {
      // Logged out
      userEmailSpan.textContent = '';
      signupForm.classList.remove('hidden');
      loginForm.classList.add('hidden');
      userInfo.classList.add('hidden');
      dashboard.classList.add('hidden');
      chatDiv.innerHTML = '';
    }
  });

  // Load chat messages and listen for new ones
  function loadChatMessages() {
    const chatRef = db.ref('liveChatMessages');
    chatRef.off(); // remove previous listeners

    chatDiv.innerHTML = '';

    chatRef.limitToLast(100).on('child_added', snapshot => {
      const msg = snapshot.val();
      appendMessage(msg);
    });

    chatRef.limitToLast(100).on('child_removed', snapshot => {
      // optionally handle deletions
    });
  }

  // Append a message to chat div
  function appendMessage(msg) {
    const p = document.createElement('p');
    const time = new Date(msg.timestamp).toLocaleTimeString();
    p.textContent = `[${time}] ${msg.user}: ${msg.text}`;
    chatDiv.appendChild(p);
    chatDiv.scrollTop = chatDiv.scrollHeight;
  }

  // Send new chat message
  chatForm.onsubmit = e => {
    e.preventDefault();
    const user = auth.currentUser;
    if (!user) return alert('You must be logged in to send messages');

    const text = messageInput.value.trim();
    if (text === '') return;

    const msg = {
      user: user.email,
      text,
      timestamp: Date.now()
    };

    db.ref('liveChatMessages').push(msg);
    messageInput.value = '';
  };
</script>
</body>
</html>
